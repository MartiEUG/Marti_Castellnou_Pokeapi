<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Combat Pokémon — Millorat</title>
<style>
/* ========= RESET & LAYOUT ========= */
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Inter, "Segoe UI", Arial, sans-serif;
  background: linear-gradient(180deg,#d8ecff 0%, #e9e7ff 100%);
  color:#111;
  min-height:100vh;
  display:flex;
  gap:24px;
}

/* Main area and sidebar */
#main {
  flex: 1;
  padding: 36px;
}
#sidebar {
  width: 340px;
  background:#fff;
  border-left: 1px solid rgba(0,0,0,0.06);
  box-shadow: -10px 12px 40px rgba(0,0,0,0.06);
  padding:18px;
  overflow:auto;
}

/* ========= HEADER ========= */
.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:20px;
  margin-bottom:22px;
}
h1 { font-size:34px; margin:0; }

/* ========= FORM CARD (millorat estil Switch) ========= */
.form-card {
  background: linear-gradient(180deg,#fff 0%, #fff 100%);
  border-radius:18px;
  padding:20px;
  width: 640px;
  box-shadow: 0 8px 26px rgba(15,30,60,0.08);
  border: 2px solid rgba(255,56,96,0.12);
  margin-bottom: 18px;
}

.form-row {
  display:flex;
  gap:12px;
  align-items:center;
  margin-bottom:12px;
}
.form-row .field {
  flex:1;
  display:flex;
  flex-direction:column;
}
.field label { font-weight:600; margin-bottom:6px; font-size:14px; color:#222; }
.field input[type="text"], .field input[type="number"] {
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #d6d7db;
  background:#f7fbff;
  font-size:15px;
}

/* buttons */
.btn {
  background:#ff3860;
  color:white;
  border:none;
  padding:10px 16px;
  border-radius:12px;
  cursor:pointer;
  font-weight:700;
  box-shadow: 0 6px 18px rgba(255,56,96,0.12);
}
.btn.ghost {
  background:#333;
  box-shadow:none;
}

/* ========= TURN INDICATOR ========= */
#turnIndicator {
  margin-top:12px;
  display:none;
  width:fit-content;
  padding:10px 14px;
  border-radius:10px;
  background:#fffbe6;
  border:1px solid #e6d08a;
  font-weight:700;
  color:#333;
  box-shadow:0 6px 18px rgba(0,0,0,0.04);
}

/* ========= POKEMON CARDS ========= */
.poke-wrap {
  margin-top:22px;
  display:flex;
  flex-wrap:wrap;
  gap:20px;
}
.poke {
  width:220px;
  border-radius:14px;
  background:white;
  box-shadow: 0 8px 24px rgba(10,30,60,0.06);
  border:1.6px solid rgba(0,0,0,0.08);
  padding:14px;
  text-align:center;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.poke[data-selected="1"] { border-color:#ff3860; box-shadow:0 0 0 3px rgba(255,56,96,0.2); }
.poke[data-selected="2"] { border-color:#3b6bff; box-shadow:0 0 0 3px rgba(59,107,255,0.2); }

.poke.disabled { opacity:0.4; filter:grayscale(100%); pointer-events:none; }

.poke h3 { margin:8px 0 6px; text-transform:lowercase; font-size:18px;}
.poke img { width:110px; height:110px; object-fit:contain; margin:6px auto; }
.poke .small { color:#666; font-weight:500; margin:6px 0 12px; }
.poke .stat { margin:8px 0; color:#333; font-weight:600; }

/* ========= SIDEBAR ========= */
.log-entry {
  background:#fcfcff;
  border-radius:10px;
  padding:10px;
  margin-bottom:8px;
  border:1px solid #eee;
  font-size:14px;
}
.time { float:right; font-size:12px; color:#777; }

</style>
</head>
<body>

<div id="main">

  <div class="header">
    <h1>Combat Pokémon</h1>
  </div>

  <div class="form-card">
    <div style="text-align:center; font-weight:700; margin-bottom:8px;">Inici del combat</div>

    <div class="form-row">
      <div class="field">
        <label>Entrenador 1</label>
        <input id="trainer1" type="text">
      </div>
      <div class="field">
        <label>Entrenador 2</label>
        <input id="trainer2" type="text">
      </div>
    </div>

    <div class="form-row">
      <label>Pokémons a carregar</label>
      <input id="numPokes" type="number" min="1" max="50" style="width:90px;">
      <button class="btn" id="loadBtn">Carregar Pokémons</button>
      <button class="btn ghost" id="resetBtn">Reiniciar combat</button>
    </div>

    <div id="turnIndicator"></div>
  </div>

  <div id="pokeArea" class="poke-wrap"></div>

</div>

<aside id="sidebar">
  <h2>Historial</h2>
  <div id="logList"></div>
</aside>

<script>
const loadBtn=document.getElementById("loadBtn");
const resetBtn=document.getElementById("resetBtn");
const logList=document.getElementById("logList");
const turnIndicator=document.getElementById("turnIndicator");
const pokeArea=document.getElementById("pokeArea");

let pokemons=[];
let selected1=null, selected2=null;
let hp1=0,hp2=0;
let turn=1;

function log(msg){
  const el = document.createElement("div");
  el.className = "log-entry";
  el.textContent = msg;
  logList.appendChild(el);
  logList.scrollTop = logList.scrollHeight;
}


function resetAll(){
  pokemons=[];
  selected1=selected2=null;
  hp1=hp2=0;
  turn=1;
  pokeArea.innerHTML="";
  logList.innerHTML="";
  document.getElementById("trainer1").value="";
  document.getElementById("trainer2").value="";
  document.getElementById("numPokes").value="";
  turnIndicator.style.display="none";
}
window.onload=resetAll;

// LOAD POKEMONS
loadBtn.onclick=async()=>{
  const n=parseInt(numPokes.value);
  const t1=trainer1.value.trim();
  const t2=trainer2.value.trim();

  if(!t1||!t2) return alert("Introdueix els noms");
  if(!n||n<1) return alert("Número incorrecte");

  pokeArea.innerHTML="";
  logList.innerHTML="";
  pokemons=[];
  selected1=selected2=null;

  for(let i=0;i<n;i++){
    const id=Math.floor(Math.random()*151)+1;
    const res=await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
    const data=await res.json();
    pokemons.push({
      name:data.name,
      img:data.sprites.front_default,
      atk:data.stats[1].base_stat,
      def:data.stats[2].base_stat,
      hp:data.stats[0].base_stat
    });
  }

  log(`S'han carregat ${pokemons.length} pokémons`);
  turn=1;
  updateTurn();
  renderPokemons();
};

resetBtn.onclick=resetAll;

function updateTurn(){
  const t1=trainer1.value.trim();
  const t2=trainer2.value.trim();
  turnIndicator.style.display="block";
  turnIndicator.textContent=(turn===1?`Torn de ${t1}`:`Torn de ${t2}`);
}

function renderPokemons(){
  pokeArea.innerHTML="";
  pokemons.forEach((p,i)=>{
    const card=document.createElement("div");
    card.className="poke";
    card.dataset.index=i;
    card.innerHTML=`
      <h3>${p.name}</h3>
      <img src="${p.img}">
      <div class="small">HP: ${p.hp}</div>
      <div class="stat">A: ${p.atk} | D: ${p.def}</div>
      <button class="btn" onclick="selectPoke(${i})">Seleccionar</button>
    `;
    pokeArea.appendChild(card);
  });
}

function selectPoke(i){
  const t1=trainer1.value.trim();
  const t2=trainer2.value.trim();

  // FIRST SELECTION
  if(!selected1){
    selected1=pokemons[i];
    hp1=selected1.hp;
    log(`${t1} selecciona ${selected1.name}`);
    markSelected(i,1);
    turn=2;
    updateTurn();
    return;
  }

  // SECOND SELECTION
  if(!selected2){
    selected2=pokemons[i];
    hp2=selected2.hp;
    log(`${t2} selecciona ${selected2.name}`);
    markSelected(i,2);
    turn=1;
    updateTurn();
    startBattle();
  }
}

function markSelected(i,n){
  document.querySelectorAll(".poke").forEach(c=>{
    c.removeAttribute("data-selected");
  });
  document.querySelector(`.poke[data-index="${i}"]`).dataset.selected=n;
}

async function startBattle(){
  const t1=trainer1.value.trim();
  const t2=trainer2.value.trim();
  
  log(`Comença el combat entre ${selected1.name} i ${selected2.name}`);

  let A={...selected1, hp:hp1};
  let B={...selected2, hp:hp2};

  while(A.hp>0 && B.hp>0){
    const attacker=(turn===1?A:B);
    const defender=(turn===1?B:A);

    const dmg=Math.max(1, attacker.atk - Math.floor(defender.def/2));
    defender.hp-=dmg;
    if(defender.hp<0) defender.hp=0;

    log(`${attacker.name} fa ${dmg} de mal. ${defender.name}: ${defender.hp} HP`);
    updateCardHp(defender.name, defender.hp);

    if(defender.hp<=0){
      const winner=(attacker===A?t1:t2);
      log(`${winner} ha guanyat!`);
      break;
    }

    turn = turn===1?2:1;
    updateTurn();

    await new Promise(r=>setTimeout(r,600));
  }
}

function updateCardHp(name,hp){
  document.querySelectorAll(".poke").forEach(c=>{
    if(c.querySelector("h3").textContent===name){
      c.querySelector(".small").textContent=`HP: ${hp}`;
      if(hp<=0) c.classList.add("disabled");
    }
  });
}
</script>

</body>
</html>
